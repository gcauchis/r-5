<form [formGroup]="form" (ngSubmit)="submit()">
    <app-template-full-width *ngIf="unit">
        <div class="tr-content">
            <app-template-full-width>
                <span class="tr-title"><span i18n="@@Label.Edit">Edit</span><span i18n="@@Label.DbDot">:</span>
                    {{form.controls.name.value}}/{{form.controls.tacticalRole.value|
                    tacticalRoleToString}}</span>
                <div class="tr-content">
                    <mat-form-field class="unit-full-width">
                        <mat-label for="faction" i18n="@@Label.Faction">Faction</mat-label>
                        <input matInput type="text" formControlName="faction" [formControl]="factionsControl"
                            [matAutocomplete]="auto" i18n-placeholder="@@Label.Faction" placeholder="Faction" />
                        <mat-autocomplete #auto="matAutocomplete">
                            <mat-option *ngFor="let faction of factionsFilteredOptions | async" [value]="faction">
                                {{faction}}
                            </mat-option>
                        </mat-autocomplete>
                    </mat-form-field><br>

                    <mat-form-field class="unit-full-width">
                        <mat-label for="name" i18n="@@Label.Name">Name</mat-label>
                        <input matInput formControlName="name" i18n-placeholder="@@Label.Name" placeholder="Name" />
                    </mat-form-field><br>

                    <mat-form-field class="unit-full-width">
                        <mat-label for="desc" i18n="@@Label.Description">Description</mat-label>
                        <textarea matInput formControlName="desc" i18n-placeholder="@@Label.Description"
                            placeholder="Description"></textarea>
                    </mat-form-field><br>

                    <app-edit-image [imageContainer]="unit"
                        (onImageBase64Change)="form.controls.imgBase64.setValue($event)"></app-edit-image><br>

                    <mat-form-field>
                        <mat-label for="dqm" i18n="@@Label.Long.DQM">Martial Quality Dice (DQM)</mat-label>
                        <mat-select *ngIf="form.controls.tacticalRole.value != TacticalRole.Civilian; else showDQM"
                            formControlName="dqm">
                            <mat-option *ngFor="let dice of dices" [value]="dice.value">{{dice.key}}</mat-option>
                        </mat-select>
                        <ng-template #showDQM>
                            <input matInput i18n-placeholder="@@Label.DQM" placeholder="DQM"
                                [value]="form.controls.dqm.value | diceToString" disabled />
                        </ng-template>
                    </mat-form-field>

                    <mat-form-field>
                        <mat-label for="dc" i18n="@@Label.Long.DC">Combat Dice (DC)</mat-label>
                        <mat-select *ngIf="form.controls.tacticalRole.value != TacticalRole.Civilian; else showDC"
                            formControlName="dc">
                            <mat-option *ngFor="let dice of dices" [value]="dice.value">{{dice.key}}</mat-option>
                        </mat-select>
                        <ng-template #showDC>
                            <input matInput i18n-placeholder="@@Label.DC" placeholder="DC"
                                [value]="form.controls.dc.value | diceToString" disabled />
                        </ng-template>
                    </mat-form-field>

                    <mat-form-field>
                        <mat-label for="pv" i18n="@@Label.Long.HP">Number of health point</mat-label>
                        <input matInput type="number" min="1" max="5" formControlName="pv" i18n-placeholder="@@Label.HP"
                            placeholder="HP" />
                    </mat-form-field><br>

                    <mat-form-field>
                        <mat-label for="unitType" i18n="@@Label.UnitType">Unit type</mat-label>
                        <mat-select formControlName="unitType">
                            <mat-option *ngFor="let unitType of unitTypes" [value]="unitType.value">{{unitType.key}}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>

                    <mat-form-field>
                        <mat-label for="size" i18n="@@Label.UnitSize">Unit size</mat-label>
                        <mat-select formControlName="size">
                            <mat-option *ngFor="let unitSize of unitSizes" [value]="unitSize.value">{{unitSize.key}}
                            </mat-option>
                        </mat-select>
                    </mat-form-field><br>

                    <mat-form-field>
                        <mat-label for="moveType" i18n="@@Label.MoveType">Move type</mat-label>
                        <mat-select formControlName="moveType">
                            <mat-option *ngFor="let moveType of moveTypes" [value]="moveType.value">{{moveType.key}}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>

                    <mat-form-field>
                        <mat-label for="tacticalMove" i18n="@@Label.TacticalMove">Tactical move</mat-label>
                        <input matInput type="number" min="0" max="100" formControlName="tacticalMove"
                            i18n-placeholder="@@Label.Move" placeholder="Move" />
                    </mat-form-field><br>

                    <mat-form-field>
                        <mat-label for="tacticalRole" i18n="@@Label.TacticalRole">Tactical role</mat-label>
                        <mat-select formControlName="tacticalRole" (ngModelChange)='onChangeTacticalRole()'>
                            <mat-option *ngFor="let tacticalRole of tacticalRoles" [value]="tacticalRole.value">
                                {{tacticalRole.key}}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>

                    <mat-form-field *ngIf="unit.tacticalRole == TacticalRole.Mage">
                        <mat-label for="mageLevel" i18n="@@Label.MageLevel">Mage level</mat-label>
                        <input matInput type="number" min="1" max="3" formControlName="mageLevel" placeholder="Level" />
                    </mat-form-field>
                </div>
                <div class="tr-actions"></div>
            </app-template-full-width>

            <app-edit-weapons-list [combatUnit]="unit" (onWeaponsChanged)="form.controls.weapons.setValue($event)">
            </app-edit-weapons-list>

            <app-armor-selector [unit]="unit" (onArmorSelectionChange)="form.controls.armor.setValue($event)">
            </app-armor-selector>
        </div>

        <div class="tr-actions">
            <button mat-raised-button type="submit" [disabled]="form.invalid" i18n="@@Label.Validate">Validate</button>
            <button mat-raised-button type="button" (click)="cancel()" i18n="@@Label.Cancel">Cancel</button>
        </div>
    </app-template-full-width>
</form>